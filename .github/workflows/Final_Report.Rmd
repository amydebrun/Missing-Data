---
title: Estimating Treatment Effects in Longitudinal Clinical Trials with Missing Data 
authors:
  - name: Amy Browne
    thanks: The authors would like to thank Neil O'Leary from the University of Galway for his valuable guidance, feedback, and support throughout the development of this project
    department: Department of Methametics
    affiliation: University of Galway
    email: k.yip2@universityofgalway.ie
  - name: Tsz Mang Yip
    department: Department of Methametics
    affiliation: University of Galway
    email: a.browne47@universityofgalway.ie
abstract:
  1. Motivation. Missing data is a pervasive issue in longitudinal clinical trials, risking bias and reduced power.
  2. Approach. This study compares several statistical methods for estimating treatment effects in the presence of missing data.
  3. Datasets. Applied to two real-world datasets (Acupuncture and VITAL studies).
  4. Findings. No meaningful differences between methods for both data sets.
  5. Conclusion. Understanding there are many ways to handle missing data, and it is crutial to understand the mechanism to make corret choise under circumstances.
keywords:
  - Missing Data
  - Longitudinal Data
  - Randomized Clinical Trial
  - Real World Data Analysis
bibliography: references.bib
biblio-style: unsrt
output: rticles::arxiv_article
header-includes:
  - \newcommand{\pandocbounded}[1]{#1}
---

```{r setup, include=FALSE, cache=TRUE}
knitr::opts_chunk$set(echo = TRUE)
library(mice)
library(tidyverse)
library(haven)
library(lme4)
library(broom.mixed)
library(meta)
library(dplyr)
library(naniar)
library(tidymodels)
library(gtsummary)
library(tinytex)
source("R scripts/Functions.R")
source("R scripts/VITAL data formats.R")
source("R scripts/Acupuncture data formats.R")
source("R scripts/Summary analysis.R")
source("R scripts/Category time analysis.R")
source("R scripts/Continuous time analysis.R")
source("R scripts/Different Imputation Method.R")
source("R scripts/Sensitive Analysis.R")

```

# Introduction

  - Clinical trials often face missing outcome data due to dropout or nonresponse.
  - Existing literature reveals inconsistent reporting and handling practices.(Power 2014)
  - Consequences: bias, reduced efficiency, invalid conclusions if not handled properly.
  - Missing mechanism MCAR, MAR, MNAR. (Missing Data Mechanisms)
  - DAG of missing mechanism
  - Objective: Evaluate how different methods perform in estimating treatment effects under varying missing data mechanisms using real data.

## Data sets

  - Source
  - Study design
  - Data overview
    - assuming not interaction in VITAL study
  - Estimands in this project

## Missing analysis

  - Missing proportion
  - Missing pattern

# Methods

## Data wrangling

  - Have data both in wide and long format
  - We have done multi imputation in wide format then transform for LME
  - Which account for reapeat measurements and will work if collecting time are more different

## Changing imputation methods

  - No imputation (complete case, LME)
  - Single imputation (LOCF, mean observation)
  - Multiple imputation (Different method, predictive value or observed value, number of m)
  - Chain equation for multi-variate missingness

## Changing substantial model

  - Simple linear regression
  - LME
  - Change estimand
  - Change linear regression to polynomial, splie...

## Sensitive analysis

  - Violation of MAR possible
  - shifting method (choosing delta, how to model)

# Result

## Comparing different methods

## Changing estimand
  - almost no impact in acupuncture study due to 2 follow-up

## Changing imputation methods

## Sensitive analysis

## Missing data in clinical research

# Discussion

  - No meaningful difference observed
  - limitation: only 2 follow up for acupuncture
  - limitation: VITAL only have weak therapeutic effect
  - further work: simulate complete data, and compare accuracy between methods

# References























# Back up writing

## Missing Data Mechanisms

Missing data mechanisms are important to consider when choosing which sort of missing data handling method to use. There are three mechanisms which missing data can follow:

- Missing Completely At Random (MCAR)
- Missing At Random (MAR)
- Missing Not At Random (MNAR)

Although they may appear similar at first glance, handling missing data without considering these mechanisms may result in biased estimates and inaccurate conclusions. 

**Missing Completely At Random**

The formal definition of MCAR data is:

$$\quad P(R = 1 \mid Y, X) = P(R = 1)$$
where $R$ is a missing data indicator (1 = Data is observed, 0 = Data is missing), $Y$ represents the variables in which the data is potentially missing and $X$ represents the observed data. The probability of the data is observed given observed data and missing data is the same as the probability of being observed without the given data. This mechanism is considered the easiest to deal with as it does not bias the result although data is rarely MCAR. This can occur due to system failure and some data is deleted accidentally, or else there is issues with the treatment system and data cannot be recorded.    


**Missing At Random**

$$\quad P(R = 1 \mid Y, X) = P(R = 1 \mid X)$$
The probability of data being observed given the rest of the data is the same as the probability being observed given the observed data. In short, the data's missingness is dependent on the observed data. For example, people with a higher body mass index may be more prone to having missing blood pressure data - this is not relative to the missing data. MAR is a more realistic mechanism than MCAR and requires more intensive handling methods. 


**Missing Not At Random**

$$\quad P(R = 1 \mid Y, X) \ne P(R = 1 \mid X)$$
The probability of data being observed is not dependent on the observed data. This mechanism is the most difficult to deal with as it relates to the unobserved data, so producing valid results is a challenge. Certain participants in a general health study may avoid answering questions truthfully about smoking habits or their diet in order to make themselves more appealing. Sensitivity analysis is an option to determine the treatment effect when assuming different mechanisms. 

## Data 

We will analyse 2 longitudinal randomised controlled trials. Both studies are designed differently with two different sample sizes, which is an advantage to our research as we can look to apply these methods in two different settings. 

## Acupuncture for chronic headache in primary care: large, pragmatic, randomised trial (Vickers et al., 2004)

**Study Design**

Vickers et al. conducted a longitudinal randomised controlled trial to determine the effect of acupuncture therapy on headache against a placebo. 

**Characteristics**

table summary

**Missing Data**

```{r}
acu_miss_perc_plot
acu_miss_perc_group
acu_miss_pattern_plot
```
-estimands 

## The Effects of Vitamin D and Marine Omega-3 Fatty Acid Supplementation on Chronic Knee Pain in Older US Adults: Results From a Randomized Trial (MacFarlane et al. 2020)

**Study Design**

**Characteristics**

table summary

**Missing Data**

```{r}
vital_miss_perc_plot
vital_miss_perc_plot_fish
vital_miss_pattern_fish
```
- estimand 

## Methods

## Complete Case Analysis

- method 
- mcar 

## Single Imputation

mean
locf 
mcar 

## Maximum Likelihood

- linear mixed effects model
- conditions 
- only suitable with missing outcome 
- mar

## Multiple Imputation

- chained equations 
- mar

## Sensitivity Analysis 

```{r}

```


## Results 

forest plots 
table of estimates 
sensitivity analysis 

























# Examples of citations, figures, tables, references
\label{sec:others}

You can insert references. Here is some text [@kour2014real; @kour2014fast] and see @hadash2018estimate.

The documentation for \verb+natbib+ may be found at

You can use custom blocks with LaTeX support from **rmarkdown** to create environment.

::: {.center latex=true}
  <http://mirrors.ctan.org/macros/latex/contrib/natbib/natnotes.pdf}>
:::

Of note is the command \verb+\citet+, which produces citations
appropriate for use in inline text.  

You can insert LaTeX environment directly too.

\begin{verbatim}
   \citet{hasselmo} investigated\dots
\end{verbatim}

produces

\begin{quote}
  Hasselmo, et al.\ (1995) investigated\dots
\end{quote}

\begin{center}
  \url{https://www.ctan.org/pkg/booktabs}
\end{center}


## Figures

You can insert figure using LaTeX directly. 

See Figure \ref{fig:fig1}. Here is how you add footnotes. [^Sample of the first footnote.]

\begin{figure}
  \centering
  \fbox{\rule[-.5cm]{4cm}{4cm} \rule[-.5cm]{4cm}{0cm}}
  \caption{Sample figure caption.}
  \label{fig:fig1}
\end{figure}

But you can also do that using R.

```{r fig2, fig.cap = "Another sample figure"}
plot(mtcars$mpg)
```

You can use **bookdown** to allow references for Tables and Figures.


## Tables

Below we can see how to use tables. 

See awesome Table~\ref{tab:table} which is written directly in LaTeX in source Rmd file.

\begin{table}
 \caption{Sample table title}
  \centering
  \begin{tabular}{lll}
    \toprule
    \multicolumn{2}{c}{Part}                   \\
    \cmidrule(r){1-2}
    Name     & Description     & Size ($\mu$m) \\
    \midrule
    Dendrite & Input terminal  & $\sim$100     \\
    Axon     & Output terminal & $\sim$10      \\
    Soma     & Cell body       & up to $10^6$  \\
    \bottomrule
  \end{tabular}
  \label{tab:table}
\end{table}

You can also use R code for that.

```{r}
knitr::kable(head(mtcars), caption = "Head of mtcars table")
```


## Lists

- Item 1
- Item 2 
- Item 3
